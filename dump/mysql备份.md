# mysql备份和恢复

## 一、备份和回复的类型

### 1.1物理备份VS 逻辑备份

物理备份由存储数据库内容的目录和文件的原始副本组成。这种类型的备份适用于需要在出现问题时快速恢复的大型重要数据库。

逻辑备份保存表示为逻辑数据库结构（[CREATE DATABASE](https://dev.mysql.com/doc/refman/5.7/en/create-database.html)， [CREATE TABLE](https://dev.mysql.com/doc/refman/5.7/en/create-table.html)语句）和内容（[INSERT](https://dev.mysql.com/doc/refman/5.7/en/insert.html)语句或分隔文本文件）的信息。这种类型的备份适用于您可能编辑数据值或表结构的较小数据量，或者在不同的计算机体系结构上重新创建数据。



**物理备份方法具有以下特征：**

1. 备份由数据库目录和文件的确切副本组成。通常这是MySQL数据目录的全部或部分的副本。

2. 物理备份方法比逻辑更快，因为它们只涉及文件复制而无需转换。

3. 输出比逻辑备份更紧凑

4. 由于备份速度和紧凑性对繁忙，重要的数据库非常重要，MySQL Enterprise Backup可以执行物理备份。

5. 备份和恢复从整个数据目录级别到单个文件级别的粒度范围。这可能会或可能不会提供表级粒度，具体取决于存储引擎。例如， InnoDB表可以分别放在一个单独的文件中，或与其他InnoDB表共享文件存储 ; 每个MyISAM表格唯一对应一组文件。

6. 除了数据库之外，备份还可以包含任何相关文件，例如日志或配置文件。

7. 来自MEMORY表格的数据很难以这种方式备份，因为它们的内容不存储在磁盘上。（MySQL Enterprise Backup产品具有可MEMORY在备份期间从表中检索数据的功能。）

8. 备份只能移植到具有相同或相似硬件特征的其他机器。

9. 备份可以在MySQL服务器不运行时执行。如果服务器正在运行，则需要执行适当的锁定，以便服务器在备份过程中不会更改数据库内容。MySQL Enterprise Backup为需要它的表自动执行此锁定。

10. 物理备份工具包括MySQL企业备份或任何其他表的 **mysqlbackup**， InnoDB或表的文件系统级命令（如**cp**， **scp**，**tar**， **rsync**）MyISAM 。

    

**逻辑备份方法具有以下特征：**

1. 备份是通过查询MySQL服务器来获得数据库结构和内容信息来完成的。

2. 备份比物理方法慢，因为服务器必须访问数据库信息并将其转换为逻辑格式。如果输出写入客户端，则服务器还必须将其发送到备份程序。

3. 输出大于物理备份，尤其是以文本格式保存时。

4. 在服务器级别（所有数据库），数据库级别（特定数据库中的所有表）或表级别都可以使用备份和还原粒度。无论存储引擎如何，情况都是如此。

5. 备份不包括日志或配置文件，或不包含不属于数据库的其他数据库相关文件。

6. 以逻辑格式存储的备份与机器无关并且非常便携。

7. 逻辑备份在MySQL服务器运行时执行。服务器未脱机。

8. 逻辑备份工具包括[mysqldump](https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html) 程序和[SELECT ... INTO OUTFILE](https://dev.mysql.com/doc/refman/5.7/en/select.html)语句。这些适用于任何存储引擎，甚至MEMORY。

9. 要恢复逻辑备份，可以使用[mysql](https://dev.mysql.com/doc/refman/5.7/en/mysql.html)客户端处理SQL格式的转储文件。要加载分隔文本文件，请使用 [LOAD DATA INFILE](https://dev.mysql.com/doc/refman/5.7/en/load-data.html)语句或 [mysqlimport](https://dev.mysql.com/doc/refman/5.7/en/mysqlimport.html)客户端。

 

### **1.2 在线VS离线**

MySQL服务器正在运行时进行在线备份，以便可以从服务器获取数据库信息。离线备份发生在服务器停止时。这种区别也可以被描述为“ 热 ”与 “ 冷 ”备份; 一个“ 温暖 ”的备份是一个在服务器保持运行，但锁定，以防止当你从外部访问数据库文件修改数据。

在线备份方法具有以下特点：

1. 该备份对其他客户端的侵扰性较小，这些客户端可以在备份期间连接到MySQL服务器，并且可以根据他们需要执行的操作访问数据。

2. 必须小心强加适当的锁定，以便不会发生损害备份完整性的数据修改。MySQL Enterprise Backup会自动进行这种锁定。

 

脱机备份方法具有以下特征：

1. 客户端可能会受到不利影响，因为服务器在备份过程中不可用。出于这个原因，这种备份通常从复制从属服务器获取，该服务器可以在不影响可用性的情况下脱机。

2. 备份程序更简单，因为客户端活动不可能受到干扰。

在线和脱机恢复数据也具备类似差别。但是，联机恢复比联机备份更有可能会影响客户端，因为恢复需要更强的锁定。在备份期间，客户端可能在备份数据时读取数据。恢复修改数据并不只是读取数据，因此客户端在恢复时必须防止其访问数据。

 

### 1.3本地VS远程

本地备份是指在mysql的实例所在的服务器上进行备份。

远程备份是指备份和服务器不在同一台机器上。

1. [mysqldump](https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html)可以连接到本地或远程服务器。对于SQL输出（CREATE和 [INSERT](https://dev.mysql.com/doc/refman/5.7/en/insert.html)语句），可以完成本地或远程转储，并在客户端上生成输出。对于分隔文本输出（使用该[--tab](#option_mysqldump_tab)选项），将在服务器主机上创建数据文件。

2. [SELECT ... INTO OUTFILE](https://dev.mysql.com/doc/refman/5.7/en/select-into.html) 可以从本地或远程客户端主机启动，但输出文件是在服务器主机上创建的。

3. 物理备份方法通常在MySQL服务器主机上本地启动，因此服务器可以脱机，但复制文件的目标可能是远程的。

 

### 1.4 快照备份

某些文件系统实现可以实现“ 快照 ” 。它们在给定的时间点提供文件系统的逻辑副本，而不需要整个文件系统的物理副本。（例如，实现可能使用写时复制技术，以便在复制快照时间之后只修改文件系统的某些部分）.MySQL本身不提供获取文件系统快照的功能。它可以通过第三方解决方案获得，例如Veritas，LVM或ZFS。

 

### 1.5完全与增量备份

完整备份包括在特定时间点由MySQL服务器管理的所有数据。增量备份包括在给定时间跨度内（从一个时间点到另一个时间点）对数据所做的更改。MySQL有不同的方法来执行完整备份。通过启用服务器的二进制日志（服务器用于记录数据更改）来实现增量备份。

 

### 1.6完全对比时间点（增量）恢复

完全恢复将恢复完整备份中的所有数据。这会将服务器实例恢复到进行备份时的状态。如果该状态不是最新状态，则完全恢复后可以恢复自完整备份以来进行的增量备份，以使服务器处于更新状态。

增量恢复是恢复在给定时间范围内所做的更改。这也称为时间点恢复，因为它使服务器的状态达到特定时间。时间点恢复基于二进制日志，通常在从备份文件完全恢复之后将服务器恢复到进行备份时的状态。然后，将写入二进制日志文件的数据更改作为增量恢复应用于重做数据修改，并使服务器达到所需的时间点。

### **1.7表维护**

如果表损坏，数据完整性可能会受到影响。对于 [InnoDB](https://dev.mysql.com/doc/refman/5.7/en/innodb-storage-engine.html)表格，这不是一个典型的问题。[MyISAM](https://dev.mysql.com/doc/refman/5.7/en/myisam-storage-engine.html) 如果程序检查表并在发现问题时进行修复

### **1.8备份调度，压缩和加密**

备份调度对于自动执行备份过程非常重要。对备份输出进行压缩可减少空间要求，对输出进行加密可提供更好的安全性，防止未经授权访问备份数据。MySQL本身不提供这些功能。MySQL企业备份产品可以压缩InnoDB备份，使用文件系统实用程序可以实现备份输出的压缩或加密。其他第三方解决方案可能可用

 

 

###  二、数据库备份方法

- 使用mysql enterprise backup进行热备份

- mysqldump，该[mysqldump的](https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html)程序可以进行备份。它可以备份各种表格,对于InnoDB表，可以使用[mysqldump](https://dev.mysql.com/doc/refman/5.7/en/mysqldump.html)  [--single-transaction](#option_mysqldump_single-transaction)选项 执行不锁定表的在线备份

- 直接复制表文件

对于使用自己的文件表示每个表的存储引擎，可以通过复制这些文件来备份表。例如， MyISAM表作为文件存储，所以很容易被复制文件（做一个备份*.frm， *.MYD以及*.MYI文件）。要获得一致的备份，请停止服务器或锁定并刷新相关表格：

FLUSH TABLES *tbl_list* WITH READ LOCK;

你只需要一个读锁; 这使其他客户端可以在制作数据库目录中的文件副本时继续查询表。需要刷新以确保在开始备份之前将所有活动的索引页面写入磁盘